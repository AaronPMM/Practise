/******************************************************************************

                  版权所有 (C), 2023-2023，78157

 ******************************************************************************
  文 件 名   : hdump.c
  版 本 号   : 初稿
  作    者   : 78157
  生成日期   : 2023/3/12
  最近修改   :
  功能描述   : 
  函数列表   :
  修改历史   :
  1.日    期   : 2023/3/12
    作    者   : 78157
    修改内容   : 创建文件

******************************************************************************/

/*----------------------------------------------*
 * 包含头文件                                   *
 *----------------------------------------------*/
#include <stdio.h>
#include <ctype.h>
#include <limits.h>
/*----------------------------------------------*
 * 外部变量说明                                 *
 *----------------------------------------------*/

/*----------------------------------------------*
 * 外部函数原型说明                             *
 *----------------------------------------------*/

/*----------------------------------------------*
 * 内部函数原型说明                             *
 *----------------------------------------------*/

/*----------------------------------------------*
 * 全局变量                                     *
 *----------------------------------------------*/

/*----------------------------------------------*
 * 模块级变量                                   *
 *----------------------------------------------*/

/*----------------------------------------------*
 * 常量定义                                     *
 *----------------------------------------------*/

/*----------------------------------------------*
 * 宏定义                                       *
 *----------------------------------------------*/

void hdump(FILE *src, FILE *dst)
{
    int n;
    unsigned long count = 0;
    unsigned char buf[16];

    while ((n = fread(buf, 1, 16, src)) > 0)
    {
        int i;

        fprintf(dst, "%08lx ", count);

        for(i = 0; i < n; i++)
        {
            fprintf(dst, "%0*x ", (CHAR_BIT + 3) / 4, (unsigned )buf[i]);
        }

        if(n < 16)
        {
            for(i = n; i < 16; i++)
            {
                fputs("   ", dst);
            }
        }

        for(i = 0; i < n; i++)
        {
            fputc(isprint(buf[i]) ? buf[i] : '.', dst);
        }

        fputc('\n', dst);
        count += 16;
    }

    fputc('\n', dst);
}

int main(int argc, char argv[])
{
    FILE *fp;

    if(argc < 2)
        hdump(stdin, stdout);
    else
    {
        while(--argc > 0)
        {
            if((fp = fopen(*++argv, "rb")) == NULL)
            {
                fprintf(stderr, "文件%s无法正确打开。\n", *argv);
                return -1;
            }
            else
            {
                hdump(fp, stdout);
                fclose(fp;)
            }
        }
    }
    return 0;
}